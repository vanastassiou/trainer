<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#2563eb">
  <title>Health Tracker</title>
  <link rel="manifest" href="manifest.json">
  <link rel="stylesheet" href="styles.css">
  <!-- Preload JS modules to avoid waterfall -->
  <link rel="modulepreload" href="js/app.js">
  <link rel="modulepreload" href="js/state.js">
  <link rel="modulepreload" href="js/db.js">
  <link rel="modulepreload" href="js/utils.js">
  <link rel="modulepreload" href="js/ui.js">
  <link rel="modulepreload" href="js/charts.js">
  <link rel="modulepreload" href="js/measurements.js">
  <link rel="modulepreload" href="js/workout.js">
  <link rel="modulepreload" href="js/programs.js">
  <link rel="modulepreload" href="js/goals.js">
  <link rel="modulepreload" href="js/learn.js">
  <link rel="modulepreload" href="js/filters.js">
  <link rel="modulepreload" href="js/validation.js">
</head>
<body>
  <header>
    <nav class="tabs">
      <button class="tab" data-tab="metrics">Metrics</button>
      <button class="tab active" data-tab="workouts">Workouts</button>
      <button class="tab" data-tab="learn">Learn</button>
      <button class="tab" data-tab="profile">Profile</button>
    </nav>
    <div id="profile-stats" class="stats-bar">
      <div class="stats-header">30-day averages</div>
      <div class="stat-item">
        <span class="stat-value" id="stat-avg-steps">--</span>
        <span class="stat-label">Steps</span>
      </div>
      <div class="stat-item">
        <span class="stat-value" id="stat-avg-calories">--</span>
        <span class="stat-label">kcal</span>
      </div>
      <div class="stat-item">
        <span class="stat-value" id="stat-avg-sleep">--</span>
        <span class="stat-label">Sleep</span>
      </div>
      <div class="stat-item">
        <span class="stat-value" id="stat-avg-protein">--</span>
        <span class="stat-label">Protein</span>
      </div>
      <div class="stat-item">
        <span class="stat-value" id="stat-avg-fibre">--</span>
        <span class="stat-label">Fibre</span>
      </div>
      <div class="stat-item">
        <span class="stat-value" id="stat-avg-water">--</span>
        <span class="stat-label">Water</span>
      </div>
    </div>
  </header>

  <main>
    <section id="metrics" class="page">
      <div class="date-header">
        <button type="button" class="nav-button date-nav prev" aria-label="Previous day">&lt;</button>
        <button type="button" class="date-display">
          <span class="date-text">Today</span>
        </button>
        <button type="button" class="nav-button date-nav next" aria-label="Next day" disabled>&gt;</button>
      </div>

      <nav class="sub-tabs">
        <button class="sub-tab active" data-subtab="daily">Daily</button>
        <button class="sub-tab" data-subtab="measurements">Measurements</button>
      </nav>

      <div id="daily" class="sub-page active">
        <div class="chart-section" id="daily-chart">
          <div class="chart-header">
            <select class="chart-timespan-select" id="daily-timespan-select">
              <option value="7">7 days</option>
              <option value="28" selected>28 days</option>
              <option value="90">3 months</option>
              <option value="180">6 months</option>
              <option value="365">1 year</option>
              <option value="all">All time</option>
            </select>
            <select class="chart-metric-select" id="daily-metric-select">
              <option value="weight">Weight</option>
              <option value="restingHR">Resting HR</option>
              <option value="calories">Calories</option>
              <option value="protein">Protein</option>
              <option value="fibre">Fibre</option>
              <option value="water">Water</option>
              <option value="steps">Steps</option>
              <option value="sleep">Sleep</option>
              <option value="recovery">Recovery</option>
            </select>
          </div>
          <canvas class="chart-canvas"></canvas>
          <div class="chart-summary"></div>
        </div>

        <form id="daily-form" class="daily-form">
          <div id="daily-fields-container"></div>

          <div class="notes-row">
            <label for="notes">Notes</label>
            <textarea id="notes" name="notes" rows="3" placeholder="How are you feeling today?"></textarea>
          </div>

          <button type="submit" class="btn accent">Save daily</button>
        </form>
      </div>

      <div id="measurements" class="sub-page">
        <div class="chart-section" id="measurements-chart">
          <div class="chart-header">
            <select class="chart-timespan-select" id="measurements-timespan-select">
              <option value="7">7 days</option>
              <option value="28" selected>28 days</option>
              <option value="90">3 months</option>
              <option value="180">6 months</option>
              <option value="365">1 year</option>
              <option value="all">All time</option>
            </select>
            <select class="chart-metric-select" id="measurements-metric-select">
              <option value="bodyFat">Body fat</option>
              <option value="waist">Waist</option>
              <option value="chest">Chest</option>
              <option value="leftBiceps">L Biceps</option>
              <option value="rightBiceps">R Biceps</option>
              <option value="hips">Hips</option>
              <option value="leftQuadriceps">L Quad</option>
              <option value="rightQuadriceps">R Quad</option>
              <option value="leftCalf">L Calf</option>
              <option value="rightCalf">R Calf</option>
              <option value="neck">Neck</option>
            </select>
          </div>
          <canvas class="chart-canvas"></canvas>
          <div class="chart-summary"></div>
        </div>

        <form id="measurements-form" class="measurements-form">
          <div id="measurement-fields-container"></div>
          <button type="submit" class="btn accent">Save measurements</button>
        </form>
      </div>
    </section>

    <section id="workouts" class="page active">
      <div class="date-header">
        <button type="button" class="nav-button date-nav prev" aria-label="Previous day">&lt;</button>
        <button type="button" class="date-display">
          <span class="date-text">Today</span>
        </button>
        <button type="button" class="nav-button date-nav next" aria-label="Next day" disabled>&gt;</button>
      </div>

      <div class="chart-section" id="workouts-chart">
        <div class="chart-header">
          <select class="chart-timespan-select" id="workouts-timespan-select">
            <option value="7">7 days</option>
            <option value="28" selected>28 days</option>
            <option value="90">3 months</option>
            <option value="180">6 months</option>
            <option value="all">All time</option>
          </select>
          <select class="chart-metric-select" id="workouts-metric-select">
          </select>
        </div>
        <canvas class="chart-canvas"></canvas>
        <div class="chart-summary"></div>
      </div>

      <p id="no-programs-message" class="empty-message hidden">No programs yet. Create one in the Profile tab.</p>
      <div class="program-selector">
        <div class="form-group" id="program-selector-group">
          <label>Program</label>
          <div class="program-display">
            <span id="current-program-name">-</span>
            <button type="button" id="change-program-btn" class="btn ghost">Change</button>
          </div>
          <select id="current-program" class="hidden">
          </select>
        </div>
        <div class="form-group" id="day-selector-group">
          <label>Day</label>
          <div class="day-selector">
            <span id="suggested-day" data-day="">-</span>
            <button type="button" id="change-day-btn" class="btn ghost">Change</button>
          </div>
          <select id="current-day" class="hidden"></select>
        </div>
      </div>

      <form id="workout-form">
        <div id="exercises-container"></div>

        <button type="button" id="add-exercise" class="btn outline-accent full">+ Add exercise</button>

        <button type="submit" class="btn accent full">Save workout</button>
      </form>
    </section>

    <section id="learn" class="page">
      <nav class="sub-tabs">
        <button class="sub-tab active" data-subtab="articles">Articles</button>
        <button class="sub-tab" data-subtab="glossary">Glossary</button>
        <button class="sub-tab" data-subtab="references">References</button>
      </nav>

      <div id="articles" class="sub-page active">
        <div class="learn-filters learn-filters--single">
          <select id="article-category-filter">
            <option value="">All categories</option>
          </select>
        </div>
        <div id="articles-container" class="learn-list"></div>
        <p id="no-articles-message" class="empty-message hidden">
          No articles yet.
        </p>
      </div>

      <div id="glossary" class="sub-page">
        <div class="learn-filters learn-filters--single">
          <select id="glossary-category-filter">
            <option value="">All categories</option>
          </select>
        </div>
        <div id="glossary-list" class="learn-list"></div>
        <p id="no-glossary-message" class="empty-message hidden">
          No terms found.
        </p>
      </div>

      <div id="references" class="sub-page">
        <div class="learn-filters learn-filters--single">
          <select id="references-type-filter">
            <option value="">All types</option>
          </select>
        </div>
        <div id="references-list" class="learn-list"></div>
        <p id="no-references-message" class="empty-message hidden">
          No references yet.
        </p>
      </div>
    </section>

    <section id="profile" class="page">
      <div class="profile-section">
        <h3>Profile</h3>

        <div id="profile-display" class="profile-display hidden">
          <dl class="profile-details">
            <dt>Name</dt>
            <dd id="display-name">--</dd>
            <dt data-term="age">Age</dt>
            <dd id="display-age">--</dd>
            <dt data-term="sex">Sex</dt>
            <dd id="display-sex">--</dd>
            <dt data-term="height">Height</dt>
            <dd id="display-height">--</dd>
            <dt>Units</dt>
            <dd id="display-units">--</dd>
          </dl>
          <button type="button" id="edit-profile-btn" class="btn">Edit</button>
        </div>

        <form id="profile-form" class="profile-form">
          <label for="profile-name">Name</label>
          <input type="text" id="profile-name" name="name" placeholder="Your name">

          <label for="profile-birthdate"><span data-term="age">Birthdate</span></label>
          <input type="date" id="profile-birthdate" name="birthDate">

          <label for="profile-sex"><span data-term="sex">Sex</span></label>
          <select id="profile-sex" name="sex">
            <option value="female">Female</option>
            <option value="male">Male</option>
          </select>

          <label for="profile-height"><span data-term="height">Height</span> <span id="height-label-unit">(cm)</span></label>
          <div class="height-inputs">
            <div id="height-metric-input" class="input-with-unit">
              <input type="number" id="profile-height" name="height" inputmode="decimal" step="0.1" min="0" placeholder="170">
            </div>
            <div id="height-imperial-input" class="input-with-unit hidden">
              <input type="number" id="profile-height-ft" name="height-ft" inputmode="numeric" min="0" max="8" placeholder="5" class="height-ft">
              <span class="unit">ft</span>
              <input type="number" id="profile-height-in" name="height-in" inputmode="decimal" step="0.5" min="0" max="11.9" placeholder="10" class="height-in">
              <span class="unit">in</span>
            </div>
          </div>

          <label for="profile-units">Units</label>
          <select id="profile-units" name="unitPreference">
            <option value="metric">Metric</option>
            <option value="imperial">Imperial</option>
          </select>

          <button type="submit" class="btn accent">Save profile</button>
        </form>
      </div>

      <div class="profile-section">
        <h3>Goals</h3>
        <div id="goals-list" class="goals-list">
          <p id="no-goals-message" class="empty-message">
            No goals set. Add a goal to start tracking your progress.
          </p>
        </div>

        <form id="add-goal-form" class="add-goal-form">
          <h4>Add goal</h4>

          <label for="goal-metric">Metric</label>
          <select id="goal-metric" name="metric" required>
              <option value="weight">Weight</option>
              <option value="bodyFat">Body fat %</option>
              <option value="waistToHeightRatio">Waist-to-height ratio</option>
          </select>
          <label for="goal-target">Target <span id="goal-target-unit"></span></label>
          <input type="number" id="goal-target" name="target" inputmode="decimal" step="any" required>
          <button type="submit" class="btn accent">Add</button>
        </form>

        <div id="completed-goals-section" class="completed-goals">
          <h4>Completed</h4>
          <div id="completed-goals-list"></div>
        </div>
      </div>

      <div id="programs" class="profile-section">
        <h3>Programs</h3>
        <nav class="sub-tabs">
          <button class="sub-tab active" data-subtab="list-programs">List</button>
          <button class="sub-tab" data-subtab="create-program">Create new</button>
        </nav>

        <div id="list-programs" class="sub-page active">
          <div id="programs-list"></div>
        </div>

        <div id="create-program" class="sub-page">
          <h4>Generate program</h4>

          <div class="form-group">
            <label for="program-days-per-week">Days per week</label>
            <select id="program-days-per-week">
              <option value="1">1 day (full body)</option>
              <option value="2">2 days (full body)</option>
              <option value="3" selected>3 days (push/pull/legs)</option>
              <option value="4">4 days (upper/lower)</option>
              <option value="5">5 days (PPL + upper/lower)</option>
              <option value="6">6 days (push/pull/legs x2)</option>
            </select>
          </div>

          <fieldset class="form-group">
            <legend>Equipment available</legend>
            <div class="checkbox-group">
              <label class="checkbox-label">
                <input type="checkbox" name="equipment" value="bodyweight" checked>
                Bodyweight
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="equipment" value="resistance_band">
                Resistance bands
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="equipment" value="dumbbell">
                Dumbbells
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="equipment" value="barbell">
                Barbells
              </label>
              <label class="checkbox-label">
                <input type="checkbox" name="equipment" value="machine">
                Machines
              </label>
            </div>
          </fieldset>

          <fieldset class="form-group">
            <legend>Difficulty</legend>
            <div class="radio-group">
              <label class="radio-label">
                <input type="radio" name="difficulty" value="beginner" checked>
                Beginner
              </label>
              <label class="radio-label">
                <input type="radio" name="difficulty" value="intermediate">
                Intermediate
              </label>
              <label class="radio-label">
                <input type="radio" name="difficulty" value="advanced">
                Advanced
              </label>
            </div>
          </fieldset>

          <fieldset class="form-group">
            <legend>Goal</legend>
            <div class="radio-group">
              <label class="radio-label">
                <input type="radio" name="goal" value="maintenance">
                Maintenance
              </label>
              <label class="radio-label">
                <input type="radio" name="goal" value="growth" checked>
                Growth
              </label>
            </div>
          </fieldset>

          <div class="form-buttons">
            <button type="button" id="generate-program-btn" class="btn accent">Generate program</button>
          </div>
        </div>
      </div>

      <div class="profile-section">
        <h3>Data</h3>
        <p class="section-desc">Back up or restore your health data.</p>
        <div class="data-actions">
          <button type="button" id="export-btn" class="btn">Export data</button>
          <button type="button" id="import-btn" class="btn">Import data</button>
          <input type="file" id="import-file" accept=".json" class="hidden">
        </div>
      </div>
    </section>
  </main>

  <!-- Exercise Info Dialog -->
  <dialog id="exercise-info-modal" class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="exercise-info-name">Exercise Name</h3>
        <button type="button" class="modal-close">&times;</button>
      </div>
      <div id="exercise-info-content" class="exercise-info-content"></div>
    </div>
  </dialog>

  <!-- Exercise Edit Dialog -->
  <dialog id="exercise-edit-modal" class="modal-dialog action-sheet">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="exercise-edit-name">Edit Exercise</h3>
        <button type="button" class="modal-close">&times;</button>
      </div>
      <div class="action-sheet-actions">
        <button type="button" class="action-sheet-btn" id="exercise-swap-btn">
          <span class="action-icon">↻</span>
          <span class="action-text">Swap exercise</span>
          <span class="action-desc">Replace with similar exercise</span>
        </button>
        <button type="button" class="action-sheet-btn danger" id="exercise-remove-btn">
          <span class="action-icon">✕</span>
          <span class="action-text">Remove exercise</span>
          <span class="action-desc">Delete from workout</span>
        </button>
      </div>
    </div>
  </dialog>

  <!-- Glossary Term Dialog -->
  <dialog id="glossary-modal" class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="glossary-term-name">Term</h3>
        <button type="button" class="modal-close">&times;</button>
      </div>
      <div id="glossary-term-content" class="glossary-content"></div>
    </div>
  </dialog>

  <!-- Edit Program Dialog -->
  <dialog id="edit-program-modal" class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit program</h3>
        <button type="button" class="modal-close">&times;</button>
      </div>
      <div class="edit-program-form">
        <div class="form-group">
          <label for="edit-program-name">Program name</label>
          <input type="text" id="edit-program-name" placeholder="e.g., Push Pull Legs" required>
        </div>
        <div class="program-days-builder">
          <label>Days</label>
          <div id="edit-program-days-container"></div>
          <button type="button" id="edit-add-day-btn" class="btn outline-accent full">+ Add day</button>
        </div>
        <div class="form-buttons">
          <button type="button" id="regenerate-program-btn" class="btn outline-accent hidden">Regenerate</button>
          <button type="button" id="save-program-btn" class="btn accent">Save program</button>
          <button type="button" id="delete-program-btn" class="btn danger">Delete program</button>
        </div>
      </div>
    </div>
  </dialog>

  <!-- Workout Switch Dialog -->
  <dialog id="workout-switch-dialog" class="modal-dialog">
    <div class="modal-content dialog-content">
      <div class="modal-header">
        <h3>Unsaved workout</h3>
      </div>
      <p class="dialog-message">You have unsaved workout data. What would you like to do?</p>
      <div class="dialog-actions">
        <button type="button" class="btn accent dialog-save-btn">Save & switch</button>
        <button type="button" class="btn dialog-discard-btn">Discard</button>
        <button type="button" class="btn ghost dialog-cancel-btn">Cancel</button>
      </div>
    </div>
  </dialog>

  <!-- Exercise Picker Dialog -->
  <dialog id="exercise-picker-modal" class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Select exercise</h3>
        <button type="button" class="modal-close">&times;</button>
      </div>
      <div class="modal-filters">
        <select id="filter-muscle-group">
          <option value="">All muscle groups</option>
        </select>
        <select id="filter-movement">
          <option value="">All movements</option>
        </select>
        <select id="filter-equipment">
          <option value="">All equipment</option>
        </select>
      </div>
      <div class="modal-search">
        <input type="text" id="exercise-search" placeholder="Search exercises...">
      </div>
      <div id="exercise-picker-list" class="exercise-picker-list"></div>
    </div>
  </dialog>

  <!-- Calendar Dialog -->
  <dialog id="calendar-modal" class="modal-dialog">
    <div class="modal-content calendar-content">
      <div class="calendar-header">
        <button type="button" class="nav-button month-nav prev" aria-label="Previous month">&lt;</button>
        <span class="month-year"></span>
        <button type="button" class="nav-button month-nav next" aria-label="Next month">&gt;</button>
      </div>
      <div class="calendar-weekdays">
        <span>Su</span><span>Mo</span><span>Tu</span><span>We</span><span>Th</span><span>Fr</span><span>Sa</span>
      </div>
      <div class="calendar-grid"></div>
      <button type="button" class="btn accent full today-btn">Today</button>
    </div>
  </dialog>

  <script type="module" src="js/app.js"></script>
</body>
</html>
